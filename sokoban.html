<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨ç®±å­æ¸¸æˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 400px;
            margin: 10px 0;
            font-weight: bold;
        }
        .game-board {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            grid-gap: 1px;
            margin: 20px 0;
            background-color: #333;
            padding: 5px;
            border-radius: 5px;
        }
        .cell {
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }
        .wall {
            background-color: #795548;
        }
        .floor {
            background-color: #e0e0e0;
        }
        .player {
            background-color: #4CAF50;
            color: white;
        }
        .box {
            background-color: #FF9800;
            color: white;
        }
        .target {
            background-color: #2196F3;
            color: white;
        }
        .box-on-target {
            background-color: #9C27B0;
            color: white;
        }
        .player-on-target {
            background-color: #00BCD4;
            color: white;
        }
        .controls {
            margin: 20px 0;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .exit-btn {
            background-color: #f44336;
        }
        .exit-btn:hover {
            background-color: #d32f2f;
        }
        .instructions {
            max-width: 500px;
            text-align: center;
            margin: 20px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>æ¨ç®±å­æ¸¸æˆ</h1>
    
    <div class="game-info">
        <div>æ­¥æ•°: <span id="moves">0</span></div>
        <div>ç›®æ ‡: <span id="targets">0</span>/<span id="total-targets">0</span></div>
    </div>
    
    <div class="game-board" id="board"></div>
    
    <div class="instructions">
        <p>ä½¿ç”¨æ–¹å‘é”®ç§»åŠ¨ç©å®¶ï¼Œå°†æ‰€æœ‰ç®±å­æ¨åˆ°ç›®æ ‡ä½ç½®ã€‚ç®±å­åªèƒ½æ¨ä¸èƒ½æ‹‰ã€‚</p>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="newGame()">æ–°æ¸¸æˆ</button>
        <button class="btn exit-btn" onclick="exitToHome()">é€€å‡ºæ¸¸æˆ</button>
    </div>

    <script>
        // æ¸¸æˆå˜é‡
        let board = [];
        let playerPos = {x: 0, y: 0};
        let moves = 0;
        let targets = 0;
        let totalTargets = 0;
        let gameOver = false;
        
        // å…³å¡æ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼‰
        const levels = [
            [
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 3, 0, 0, 0, 0, 3, 0, 1],
                [1, 0, 0, 2, 0, 0, 0, 0, 0, 1],
                [1, 0, 0, 0, 3, 0, 0, 0, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
            ]
        ];
        
        // åœ°å›¾å…ƒç´ 
        const elements = {
            0: 'floor',    // ç©ºåœ°
            1: 'wall',     // å¢™
            2: 'player',   // ç©å®¶
            3: 'box',      // ç®±å­
            4: 'target'    // ç›®æ ‡
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            moves = 0;
            targets = 0;
            gameOver = false;
            
            document.getElementById('moves').textContent = moves;
            
            // åŠ è½½å…³å¡
            const level = levels[0];
            board = JSON.parse(JSON.stringify(level));
            
            // æ‰¾åˆ°ç©å®¶ä½ç½®å’Œç»Ÿè®¡ç›®æ ‡
            totalTargets = 0;
            for (let i = 0; i < board.length; i++) {
                for (let j = 0; j < board[i].length; j++) {
                    if (board[i][j] === 2) {
                        playerPos = {x: j, y: i};
                        board[i][j] = 0; // å°†ç©å®¶ä½ç½®è®¾ä¸ºç©ºåœ°
                    } else if (board[i][j] === 4) {
                        totalTargets++;
                    }
                }
            }
            
            document.getElementById('total-targets').textContent = totalTargets;
            document.getElementById('targets').textContent = targets;
            
            // æ¸²æŸ“æ¸¸æˆæ¿
            render();
        }
        
        // æ¸²æŸ“æ¸¸æˆæ¿
        function render() {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            
            for (let i = 0; i < board.length; i++) {
                for (let j = 0; j < board[i].length; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    
                    // æ ¹æ®å…ƒç´ ç±»å‹è®¾ç½®æ ·å¼
                    switch (board[i][j]) {
                        case 0:
                            cell.classList.add('floor');
                            break;
                        case 1:
                            cell.classList.add('wall');
                            break;
                        case 3:
                            cell.classList.add('box');
                            cell.textContent = 'ğŸ“¦';
                            break;
                        case 4:
                            cell.classList.add('target');
                            cell.textContent = 'â­•';
                            break;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç©å®¶ä½ç½®
                    if (playerPos.x === j && playerPos.y === i) {
                        cell.classList.add('player');
                        cell.textContent = 'ğŸ˜Š';
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç®±å­åœ¨ç›®æ ‡ä¸Š
                    if (board[i][j] === 3 && isTarget(i, j)) {
                        cell.classList.remove('box');
                        cell.classList.add('box-on-target');
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯ç©å®¶åœ¨ç›®æ ‡ä¸Š
                    if (playerPos.x === j && playerPos.y === i && isTarget(i, j)) {
                        cell.classList.remove('player');
                        cell.classList.add('player-on-target');
                    }
                    
                    boardElement.appendChild(cell);
                }
            }
        }
        
        // æ£€æŸ¥ä½ç½®æ˜¯å¦æ˜¯ç›®æ ‡
        function isTarget(row, col) {
            // åœ¨è¿™ä¸ªç®€åŒ–ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨åŸºç¡€åœ°å›¾ä¸­å­˜å‚¨ç›®æ ‡ä½ç½®
            // å®é™…æ¸¸æˆä¸­åº”è¯¥æœ‰ä¸€ä¸ªå•ç‹¬çš„ç›®æ ‡ä½ç½®æ•°ç»„
            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸€äº›ç›®æ ‡ä½ç½®
            const targetPositions = [
                {row: 2, col: 3},
                {row: 4, col: 5},
                {row: 6, col: 7}
            ];
            
            return targetPositions.some(pos => pos.row === row && pos.col === col);
        }
        
        // ç§»åŠ¨ç©å®¶
        function movePlayer(dx, dy) {
            if (gameOver) return;
            
            const newX = playerPos.x + dx;
            const newY = playerPos.y + dy;
            
            // æ£€æŸ¥è¾¹ç•Œ
            if (newY < 0 || newY >= board.length || newX < 0 || newX >= board[0].length) {
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯å¢™
            if (board[newY][newX] === 1) {
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç®±å­
            if (board[newY][newX] === 3) {
                const boxNewX = newX + dx;
                const boxNewY = newY + dy;
                
                // æ£€æŸ¥ç®±å­æ˜¯å¦å¯ä»¥ç§»åŠ¨
                if (boxNewY < 0 || boxNewY >= board.length || boxNewX < 0 || boxNewX >= board[0].length) {
                    return;
                }
                
                if (board[boxNewY][boxNewX] === 1 || board[boxNewY][boxNewX] === 3) {
                    return;
                }
                
                // ç§»åŠ¨ç®±å­
                board[boxNewY][boxNewX] = 3;
                board[newY][newX] = 0;
            }
            
            // ç§»åŠ¨ç©å®¶
            playerPos.x = newX;
            playerPos.y = newY;
            
            // å¢åŠ æ­¥æ•°
            moves++;
            document.getElementById('moves').textContent = moves;
            
            // é‡æ–°æ¸²æŸ“
            render();
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            checkWin();
        }
        
        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        function checkWin() {
            // ç»Ÿè®¡åœ¨ç›®æ ‡ä¸Šçš„ç®±å­æ•°é‡
            let boxesOnTarget = 0;
            
            for (let i = 0; i < board.length; i++) {
                for (let j = 0; j < board[i].length; j++) {
                    if (board[i][j] === 3 && isTarget(i, j)) {
                        boxesOnTarget++;
                    }
                }
            }
            
            targets = boxesOnTarget;
            document.getElementById('targets').textContent = targets;
            
            // å¦‚æœæ‰€æœ‰ç›®æ ‡éƒ½è¢«ç®±å­å æ®ï¼Œè·èƒœ
            if (targets === totalTargets && totalTargets > 0) {
                gameOver = true;
                setTimeout(() => {
                    alert(`æ­å–œä½ å®Œæˆæ¨ç®±å­ï¼ç”¨äº†${moves}æ­¥ã€‚`);
                }, 100);
            }
        }
        
        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowUp':
                    movePlayer(0, -1);
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                    movePlayer(0, 1);
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                    movePlayer(-1, 0);
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                    movePlayer(1, 0);
                    e.preventDefault();
                    break;
            }
        });
        
        // æ–°æ¸¸æˆ
        function newGame() {
            initGame();
        }
        
        // é€€å‡ºåˆ°ä¸»é¡µ
        function exitToHome() {
            window.location.href = 'index.html';
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>