<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›·æ¸¸æˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 400px;
            margin: 10px 0;
            font-weight: bold;
        }
        .minesweeper-board {
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-gap: 2px;
            margin: 20px 0;
        }
        .cell {
            width: 30px;
            height: 30px;
            background-color: #ccc;
            border: 2px outset #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }
        .cell.revealed {
            background-color: #eee;
            border: 1px solid #999;
        }
        .cell.flagged::before {
            content: "ğŸš©";
        }
        .controls {
            margin: 20px 0;
        }
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .exit-btn {
            background-color: #f44336;
        }
        .exit-btn:hover {
            background-color: #d32f2f;
        }
        .instructions {
            max-width: 500px;
            text-align: center;
            margin: 20px 0;
            color: #666;
        }
        .mine {
            background-color: #ff6b6b;
        }
    </style>
</head>
<body>
    <h1>æ‰«é›·æ¸¸æˆ</h1>
    
    <div class="game-info">
        <div>å‰©ä½™é›·æ•°: <span id="mine-count">15</span></div>
        <div>æ—¶é—´: <span id="timer">0</span>s</div>
    </div>
    
    <div class="minesweeper-board" id="board"></div>
    
    <div class="instructions">
        <p>å·¦é”®ç‚¹å‡»æ­å¼€æ–¹å—ï¼Œå³é”®ç‚¹å‡»æ ‡è®°åœ°é›·ã€‚æ­å¼€æ‰€æœ‰éåœ°é›·æ–¹å—å³å¯è·èƒœã€‚</p>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="initGame()">æ–°æ¸¸æˆ</button>
        <button class="btn exit-btn" onclick="exitToHome()">é€€å‡ºæ¸¸æˆ</button>
    </div>

    <script>
        const boardElement = document.getElementById('board');
        const mineCountElement = document.getElementById('mine-count');
        const timerElement = document.getElementById('timer');
        
        // æ¸¸æˆè®¾ç½®
        const rows = 10;
        const cols = 10;
        const mineCount = 15;
        
        // æ¸¸æˆçŠ¶æ€
        let board = [];
        let minePositions = [];
        let revealedCount = 0;
        let flaggedCount = 0;
        let gameOver = false;
        let gameStarted = false;
        let startTime = null;
        let timerInterval = null;
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            board = [];
            minePositions = [];
            revealedCount = 0;
            flaggedCount = 0;
            gameOver = false;
            gameStarted = false;
            mineCountElement.textContent = mineCount;
            timerElement.textContent = '0';
            
            // æ¸…é™¤è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // æ¸…ç©ºæ£‹ç›˜
            boardElement.innerHTML = '';
            
            // åˆ›å»ºç©ºæ£‹ç›˜
            for (let i = 0; i < rows; i++) {
                board[i] = [];
                for (let j = 0; j < cols; j++) {
                    board[i][j] = {
                        isMine: false,
                        revealed: false,
                        flagged: false,
                        neighborMines: 0
                    };
                    
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    // å·¦é”®ç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('click', () => revealCell(i, j));
                    
                    // å³é”®ç‚¹å‡»äº‹ä»¶
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        toggleFlag(i, j);
                    });
                    
                    boardElement.appendChild(cell);
                }
            }
        }
        
        // æ”¾ç½®åœ°é›·
        function placeMines(firstClickRow, firstClickCol) {
            let minesPlaced = 0;
            
            while (minesPlaced < mineCount) {
                const row = Math.floor(Math.random() * rows);
                const col = Math.floor(Math.random() * cols);
                
                // ç¡®ä¿ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®ä¸æ˜¯åœ°é›·ï¼Œå¹¶ä¸”è¯¥ä½ç½®è¿˜æ²¡æœ‰åœ°é›·
                if ((row !== firstClickRow || col !== firstClickCol) && !board[row][col].isMine) {
                    board[row][col].isMine = true;
                    minePositions.push({row, col});
                    minesPlaced++;
                }
            }
            
            // è®¡ç®—æ¯ä¸ªå•å…ƒæ ¼å‘¨å›´çš„åœ°é›·æ•°é‡
            calculateNeighborMines();
        }
        
        // è®¡ç®—ç›¸é‚»åœ°é›·æ•°
        function calculateNeighborMines() {
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (!board[i][j].isMine) {
                        let count = 0;
                        
                        // æ£€æŸ¥å‘¨å›´çš„8ä¸ªå•å…ƒæ ¼
                        for (let di = -1; di <= 1; di++) {
                            for (let dj = -1; dj <= 1; dj++) {
                                if (di === 0 && dj === 0) continue;
                                
                                const ni = i + di;
                                const nj = j + dj;
                                
                                if (ni >= 0 && ni < rows && nj >= 0 && nj < cols) {
                                    if (board[ni][nj].isMine) {
                                        count++;
                                    }
                                }
                            }
                        }
                        
                        board[i][j].neighborMines = count;
                    }
                }
            }
        }
        
        // æ­å¼€å•å…ƒæ ¼
        function revealCell(row, col) {
            // å¦‚æœæ¸¸æˆç»“æŸæˆ–å•å…ƒæ ¼å·²è¢«æ­å¼€æˆ–å·²æ ‡è®°ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
            if (gameOver || board[row][col].revealed || board[row][col].flagged) {
                return;
            }
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œæ”¾ç½®åœ°é›·
            if (!gameStarted) {
                gameStarted = true;
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
                placeMines(row, col);
            }
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            // å¦‚æœæ˜¯åœ°é›·
            if (board[row][col].isMine) {
                cell.classList.add('revealed', 'mine');
                cell.textContent = 'ğŸ’£';
                gameOver = true;
                clearInterval(timerInterval);
                revealAllMines();
                setTimeout(() => alert('æ¸¸æˆç»“æŸï¼ä½ è¸©åˆ°åœ°é›·äº†ã€‚'), 100);
                return;
            }
            
            // æ ‡è®°ä¸ºå·²æ­å¼€
            board[row][col].revealed = true;
            revealedCount++;
            cell.classList.add('revealed');
            
            // æ˜¾ç¤ºç›¸é‚»åœ°é›·æ•°ï¼ˆå¦‚æœä¸ä¸º0ï¼‰
            if (board[row][col].neighborMines > 0) {
                cell.textContent = board[row][col].neighborMines;
                
                // è®¾ç½®æ•°å­—é¢œè‰²
                const colors = ['', '#0000FF', '#008000', '#FF0000', '#000080', '#800000', '#008080', '#000000', '#808080'];
                cell.style.color = colors[board[row][col].neighborMines];
            } else {
                // å¦‚æœç›¸é‚»æ²¡æœ‰åœ°é›·ï¼Œè‡ªåŠ¨æ­å¼€å‘¨å›´çš„å•å…ƒæ ¼
                for (let di = -1; di <= 1; di++) {
                    for (let dj = -1; dj <= 1; dj++) {
                        if (di === 0 && dj === 0) continue;
                        
                        const ni = row + di;
                        const nj = col + dj;
                        
                        if (ni >= 0 && ni < rows && nj >= 0 && nj < cols) {
                            if (!board[ni][nj].revealed && !board[ni][nj].flagged) {
                                revealCell(ni, nj);
                            }
                        }
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦è·èƒœ
            checkWin();
        }
        
        // åˆ‡æ¢æ ‡è®°
        function toggleFlag(row, col) {
            // å¦‚æœæ¸¸æˆç»“æŸæˆ–å•å…ƒæ ¼å·²è¢«æ­å¼€ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
            if (gameOver || board[row][col].revealed) {
                return;
            }
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            
            if (board[row][col].flagged) {
                // å–æ¶ˆæ ‡è®°
                board[row][col].flagged = false;
                cell.classList.remove('flagged');
                flaggedCount--;
            } else {
                // æ ‡è®°
                board[row][col].flagged = true;
                cell.classList.add('flagged');
                flaggedCount++;
            }
            
            // æ›´æ–°å‰©ä½™é›·æ•°æ˜¾ç¤º
            mineCountElement.textContent = mineCount - flaggedCount;
        }
        
        // æ­å¼€æ‰€æœ‰åœ°é›·
        function revealAllMines() {
            minePositions.forEach(pos => {
                if (!board[pos.row][pos.col].flagged) {
                    const cell = document.querySelector(`.cell[data-row="${pos.row}"][data-col="${pos.col}"]`);
                    cell.classList.add('revealed', 'mine');
                    cell.textContent = 'ğŸ’£';
                }
            });
        }
        
        // æ£€æŸ¥æ˜¯å¦è·èƒœ
        function checkWin() {
            // æ€»å•å…ƒæ ¼æ•°å‡å»åœ°é›·æ•°ç­‰äºéœ€è¦æ­å¼€çš„å•å…ƒæ ¼æ•°
            if (revealedCount === rows * cols - mineCount) {
                gameOver = true;
                clearInterval(timerInterval);
                setTimeout(() => alert(`æ­å–œä½ è·èƒœäº†ï¼ç”¨æ—¶${timerElement.textContent}ç§’ã€‚`), 100);
            }
        }
        
        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            if (gameStarted && !gameOver) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timerElement.textContent = elapsed;
            }
        }
        
        // é€€å‡ºåˆ°ä¸»é¡µ
        function exitToHome() {
            window.location.href = 'index.html';
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>